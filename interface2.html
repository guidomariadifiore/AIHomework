<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>ISEQL Event Designer</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background-color: #f4f4f4;
        }

        .step-card {
            background: #fff;
            border: 1px solid #ddd;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .hidden {
            display: none;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        h2 {
            margin-top: 0;
            color: #2c3e50;
            font-size: 1.2em;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
        }

        .btn:hover {
            background-color: #2980b9;
        }
    </style>
</head>

<body>

    <div id="app-container" style="max-width: 900px; margin: 0 auto;">

        <div class="step-card" id="step-0" style="border-left: 5px solid #e74c3c;">
            <h2>0. Event Definition</h2>
            <div class="input-group">
                <label>Event Name</label>
                <input type="text" id="event-name" placeholder="e.g., SuspiciousHandover">
            </div>
        </div>

        <div class="step-card" id="step-1">
            <h2>1. Select Sub-Events</h2>
            <div style="display: flex; gap: 20px;">
                <div style="flex: 1;">
                    <h3>First Interval (M1)</h3>
                    <select id="op1-predicate" class="operand-select"></select>

                    <div id="op1-schema-display"
                        style="background:#fff3cd; padding:10px; margin:10px 0; border:1px solid #ffeeba; border-radius:4px; font-size:0.85em; display:none;">
                        <strong>Event Output Schema:</strong>
                        <ul style="margin:5px 0 0 15px; padding:0;"></ul>
                    </div>

                    <div class="input-group" id="op1-args-container">
                        <input type="text" id="op1-arg1" placeholder="Arg1 Filter (e.g. p1)">
                        <input type="text" id="op1-arg2" placeholder="Arg2 Filter (e.g. pkg1)">
                    </div>
                </div>

                <div style="flex: 1;">
                    <h3>Second Interval (M2)</h3>
                    <select id="op2-predicate" class="operand-select"></select>

                    <div id="op2-schema-display"
                        style="background:#fff3cd; padding:10px; margin:10px 0; border:1px solid #ffeeba; border-radius:4px; font-size:0.85em; display:none;">
                        <strong>Event Output Schema:</strong>
                        <ul style="margin:5px 0 0 15px; padding:0;"></ul>
                    </div>

                    <div class="input-group" id="op2-args-container">
                        <input type="text" id="op2-arg1" placeholder="Arg1 Filter">
                        <input type="text" id="op2-arg2" placeholder="Arg2 Filter">
                    </div>
                </div>
            </div>
        </div>

        <div class="step-card" id="step-2">
            <h2>2. Temporal Relationship</h2>
            <div class="input-group">
                <label><input type="radio" name="temp-relation" value="sequential" checked> Sequential</label>
                <label><input type="radio" name="temp-relation" value="overlapping"> Overlapping</label>
            </div>
            <div id="sequential-options" class="options-box">
                <select id="seq-order">
                    <option value="before">Before</option>
                    <option value="after">After</option>
                </select>
                <input type="number" id="seq-max-gap" placeholder="Max Gap (delta)">
            </div>
            <div id="overlapping-options" class="options-box hidden">
                <select id="overlap-type">
                    <option value="DJ">During Join</option>
                    <option value="SP">Start Preceding</option>
                    <option value="EF">End Following</option>
                    <option value="LOJ">Left Overlap</option>
                </select>
                <input type="number" id="overlap-delta" placeholder="Delta">
                <input type="number" id="overlap-epsilon" placeholder="Epsilon">
            </div>
        </div>

        <div class="step-card" id="step-3">
            <h2>3. Constraints & Filters</h2>
            <div id="constraints-list"></div>
            <button class="btn" id="add-constraint-btn">+ Add Constraint</button>
            <div style="margin-top:10px;">
                <label><input type="checkbox" id="exclusion-mode"> Exclusion Mode (Set Difference)</label>
            </div>
        </div>

        <div class="step-card" id="step-4" style="border-left: 5px solid #8e44ad;">
            <h2>4. Output Projection (Schema Definition)</h2>
            <p>Define what your new event returns. Map internal values to output columns.</p>

            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                <div style="flex: 1;">
                    <label>New Start Frame Source</label>
                    <select id="proj-sf">
                        <option value="M1.sf">M1 Start (M1.sf)</option>
                        <option value="M2.sf">M2 Start (M2.sf)</option>
                        <option value="M1.ef">M1 End (M1.ef)</option>
                    </select>
                </div>
                <div style="flex: 1;">
                    <label>New End Frame Source</label>
                    <select id="proj-ef">
                        <option value="M2.ef">M2 End (M2.ef)</option>
                        <option value="M1.ef">M1 End (M1.ef)</option>
                        <option value="M2.sf">M2 Start (M2.sf)</option>
                    </select>
                </div>
            </div>

            <label>Output Arguments (Columns)</label>
            <div id="projection-list"></div>
            <button class="btn" id="add-proj-col-btn" style="background-color: #9b59b6; margin-top:10px;">+ Add Output
                Column</button>
        </div>

        <div class="step-card" style="background-color: #eaf2f8; border-color: #a9cce3;">
            <h2>5. Finalize</h2>
            <div style="display: flex; gap: 10px;">
                <button class="btn" id="generate-btn" style="flex: 1;">Generate Code</button>
                <button class="btn" id="save-event-btn" style="flex: 1; background-color: #27ae60;">Save to
                    Library</button>
            </div>
            <textarea id="output-area" rows="10" style="width: 100%; margin-top: 15px; font-family: monospace;"
                readonly></textarea>
        </div>

    </div>

    <script src="iseql-logic.js"></script>

</body>

</html>